/*
 Gibberish-AES 
 A lightweight Javascript Libray for OpenSSL compatible AES CBC encryption.

 Author: Mark Percival
 Email: mark@mpercival.com
 Copyright: Mark Percival - http://mpercival.com 2008

 With thanks to:
 Josh Davis - http://www.josh-davis.org/ecmaScrypt
 Chris Veness - http://www.movable-type.co.uk/scripts/aes.html
 Michel I. Gallant - http://www.jensign.com/

 License: MIT

 Usage: GibberishAES.enc("secret", "password")
 Outputs: AES Encrypted text encoded in Base64
*/
var GibberishAES=(function(){var p=14,v=8,f=false,Q=function(R){try{return unescape(encodeURIComponent(R))}catch(S){throw"Error on UTF-8 encode"}},N=function(R){try{return decodeURIComponent(escape(R))}catch(S){throw ("Bad Key")}},D=function(T){var U=[],S,R;if(T.length<16){S=16-T.length;U=[S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S]}for(R=0;R<T.length;R++){U[R]=T[R]}return U},l=function(V,T){var R="",U,S;if(T){U=V[15];if(U>16){throw ("Decryption error: Maybe bad key")}if(U==16){return""}for(S=0;S<16-U;S++){R+=String.fromCharCode(V[S])}}else{for(S=0;S<16;S++){R+=String.fromCharCode(V[S])}}return R},r=function(T){var R="",S;for(S=0;S<T.length;S++){R+=(T[S]<16?"0":"")+T[S].toString(16)}return R},E=function(S){var R=[];S.replace(/(..)/g,function(T){R.push(parseInt(T,16))});return R},o=function(R,U){var T=[],S;if(!U){R=Q(R)}for(S=0;S<R.length;S++){T[S]=R.charCodeAt(S)}return T},c=function(R){switch(R){case 128:p=10;v=4;break;case 192:p=12;v=6;break;case 256:p=14;v=8;break;default:throw ("Invalid Key Size Specified:"+R)}},t=function(S){var R=[],T;for(T=0;T<S;T++){R=R.concat(Math.floor(Math.random()*256))}return R},q=function(V,X){var Y=p>=12?3:2,W=[],T=[],R=[],Z=[],S=V.concat(X),U;R[0]=GibberishAES.Hash.MD5(S);Z=R[0];for(U=1;U<Y;U++){R[U]=GibberishAES.Hash.MD5(R[U-1].concat(S));Z=Z.concat(R[U])}W=Z.slice(0,4*v);T=Z.slice(4*v,4*v+16);return{key:W,iv:T}},b=function(V,U,S){U=J(U);var X=Math.ceil(V.length/16),W=[],T,R=[];for(T=0;T<X;T++){W[T]=D(V.slice(T*16,T*16+16))}if(V.length%16===0){W.push([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]);X++}for(T=0;T<W.length;T++){W[T]=(T===0)?C(W[T],S):C(W[T],R[T-1]);R[T]=d(W[T],U)}return R},y=function(X,Y,T,U){Y=J(Y);var Z=X.length/16,S=[],V,R=[],W="";for(V=0;V<Z;V++){S.push(X.slice(V*16,(V+1)*16))}for(V=S.length-1;V>=0;V--){R[V]=I(S[V],Y);R[V]=(V===0)?C(R[V],T):C(R[V],S[V-1])}for(V=0;V<Z-1;V++){W+=l(R[V])}W+=l(R[V],true);return U?W:N(W)},d=function(U,T){f=false;var S=L(U,T,0),R;for(R=1;R<(p+1);R++){S=M(S);S=a(S);if(R<p){S=P(S)}S=L(S,T,R)}return S},I=function(U,T){f=true;var S=L(U,T,p),R;for(R=p-1;R>-1;R--){S=a(S);S=M(S);S=L(S,T,R);if(R>0){S=P(S)}}return S},M=function(V){var U=f?B:O,R=[],T;for(T=0;T<16;T++){R[T]=U[V[T]]}return R},a=function(U){var R=[],T=f?[0,13,10,7,4,1,14,11,8,5,2,15,12,9,6,3]:[0,5,10,15,4,9,14,3,8,13,2,7,12,1,6,11],S;for(S=0;S<16;S++){R[S]=U[T[S]]}return R},P=function(S){var R=[],T;if(!f){for(T=0;T<4;T++){R[T*4]=z[S[T*4]]^e[S[1+T*4]]^S[2+T*4]^S[3+T*4];R[1+T*4]=S[T*4]^z[S[1+T*4]]^e[S[2+T*4]]^S[3+T*4];R[2+T*4]=S[T*4]^S[1+T*4]^z[S[2+T*4]]^e[S[3+T*4]];R[3+T*4]=e[S[T*4]]^S[1+T*4]^S[2+T*4]^z[S[3+T*4]]}}else{for(T=0;T<4;T++){R[T*4]=n[S[T*4]]^k[S[1+T*4]]^G[S[2+T*4]]^h[S[3+T*4]];R[1+T*4]=h[S[T*4]]^n[S[1+T*4]]^k[S[2+T*4]]^G[S[3+T*4]];R[2+T*4]=G[S[T*4]]^h[S[1+T*4]]^n[S[2+T*4]]^k[S[3+T*4]];R[3+T*4]=k[S[T*4]]^G[S[1+T*4]]^h[S[2+T*4]]^n[S[3+T*4]]}}return R},L=function(U,V,S){var R=[],T;for(T=0;T<16;T++){R[T]=U[T]^V[S][T]}return R},C=function(U,T){var R=[],S;for(S=0;S<16;S++){R[S]=U[S]^T[S]}return R},J=function(W){var R=[],S=[],V,X,U,Y=[],T;for(V=0;V<v;V++){X=[W[4*V],W[4*V+1],W[4*V+2],W[4*V+3]];R[V]=X}for(V=v;V<(4*(p+1));V++){R[V]=[];for(U=0;U<4;U++){S[U]=R[V-1][U]}if(V%v===0){S=x(w(S));S[0]^=K[V/v-1]}else{if(v>6&&V%v==4){S=x(S)}}for(U=0;U<4;U++){R[V][U]=R[V-v][U]^S[U]}}for(V=0;V<(p+1);V++){Y[V]=[];for(T=0;T<4;T++){Y[V].push(R[V*4+T][0],R[V*4+T][1],R[V*4+T][2],R[V*4+T][3])}}return Y},x=function(R){for(var S=0;S<4;S++){R[S]=O[R[S]]}return R},w=function(R){var T=R[0],S;for(S=0;S<4;S++){R[S]=R[S+1]}R[3]=T;return R},g=function(T,R){var S=[];for(i=0;i<T.length;i+=2){S[i/2]=parseInt(T.substr(i,2),16)}return S},H=function(T,R){var S=[];for(i=0;i<T.length;i+=2){S[i/2]=parseInt(T.substr(i,2),16)}return S},H=function(T,R){var S=[];for(i=0;i<T.length;i+=8){S[i/8]=parseInt(T.substr(i,8),16)}return S},j=function(R){var S=[];for(i=0;i<R.length;i++){S[R[i]]=i}return S},A=function(R){multx=function(V,U){var X,W;W=0;for(X=0;X<8;X++){W=((U&1)==1)?W^V:W;V=(V>127)?283^(V<<1):(V<<1);U>>>=1}return W};var T=[];for(var S=0;S<256;S++){T[S]=multx(R,S)}return T},O=g("637c777bf26b6fc53001672bfed7ab76ca82c97dfa5947f0add4a2af9ca472c0b7fd9326363ff7cc34a5e5f171d8311504c723c31896059a071280e2eb27b27509832c1a1b6e5aa0523bd6b329e32f8453d100ed20fcb15b6acbbe394a4c58cfd0efaafb434d338545f9027f503c9fa851a3408f929d38f5bcb6da2110fff3d2cd0c13ec5f974417c4a77e3d645d197360814fdc222a908846eeb814de5e0bdbe0323a0a4906245cc2d3ac629195e479e7c8376d8dd54ea96c56f4ea657aae08ba78252e1ca6b4c6e8dd741f4bbd8b8a703eb5664803f60e613557b986c11d9ee1f8981169d98e949b1e87e9ce5528df8ca1890dbfe6426841992d0fb054bb16"),B=j(O),K=g("01020408102040801b366cd8ab4d9a2f5ebc63c697356ad4b37dfaefc591"),z=A(2),e=A(3),h=A(9),k=A(11),G=A(13),n=A(14),s=function(V,Y,T){var U=t(8),X=q(o(Y,T),U),Z=X.key,S=X.iv,R,W=[[83,97,108,116,101,100,95,95].concat(U)];V=o(V,T);R=b(V,Z,S);R=W.concat(R);return Base64.encode(R)},u=function(T,W,Y){var S=Base64.decode(T),V=S.slice(8,16),X=q(o(W,Y),V),U=X.key,R=X.iv;S=S.slice(16,S.length);T=y(S,U,R,Y);return T},m=function(V){function U(aq,ap){return(aq<<ap)|(aq>>>(32-ap))}function aa(au,aq){var aw,ap,at,av,ar;at=(au&2147483648);av=(aq&2147483648);aw=(au&1073741824);ap=(aq&1073741824);ar=(au&1073741823)+(aq&1073741823);if(aw&ap){return(ar^2147483648^at^av)}if(aw|ap){if(ar&1073741824){return(ar^3221225472^at^av)}else{return(ar^1073741824^at^av)}}else{return(ar^at^av)}}function aj(ap,ar,aq){return(ap&ar)|((~ap)&aq)}function ai(ap,ar,aq){return(ap&aq)|(ar&(~aq))}function ah(ap,ar,aq){return(ap^ar^aq)}function W(ap,ar,aq){return(ar^(ap|(~aq)))}function ac(ar,aq,aw,av,ap,at,au){ar=aa(ar,aa(aa(aj(aq,aw,av),ap),au));return aa(U(ar,at),aq)}function al(ar,aq,aw,av,ap,at,au){ar=aa(ar,aa(aa(ai(aq,aw,av),ap),au));return aa(U(ar,at),aq)}function T(ar,aq,aw,av,ap,at,au){ar=aa(ar,aa(aa(ah(aq,aw,av),ap),au));return aa(U(ar,at),aq)}function ab(ar,aq,aw,av,ap,at,au){ar=aa(ar,aa(aa(W(aq,aw,av),ap),au));return aa(U(ar,at),aq)}function ad(aw){var ax,at=aw.length,ar=at+8,aq=(ar-(ar%64))/64,av=(aq+1)*16,ay=[],ap=0,au=0;while(au<at){ax=(au-(au%4))/4;ap=(au%4)*8;ay[ax]=(ay[ax]|(aw[au]<<ap));au++}ax=(au-(au%4))/4;ap=(au%4)*8;ay[ax]=ay[ax]|(128<<ap);ay[av-2]=at<<3;ay[av-1]=at>>>29;return ay}function R(ar){var at,ap,aq=[];for(ap=0;ap<=3;ap++){at=(ar>>>(ap*8))&255;aq=aq.concat(at)}return aq}var Z=[],af,ag,S,Y,ae,ao,an,am,ak,X=H("67452301EFCDAB8998BADCFE10325476D76AA478E8C7B756242070DBC1BDCEEEF57C0FAF4787C62AA8304613FD469501698098D88B44F7AFFFFF5BB1895CD7BE6B901122FD987193A679438E49B40821F61E2562C040B340265E5A51E9B6C7AAD62F105D02441453D8A1E681E7D3FBC821E1CDE6C33707D6F4D50D87455A14EDA9E3E905FCEFA3F8676F02D98D2A4C8AFFFA39428771F6816D9D6122FDE5380CA4BEEA444BDECFA9F6BB4B60BEBFBC70289B7EC6EAA127FAD4EF308504881D05D9D4D039E6DB99E51FA27CF8C4AC5665F4292244432AFF97AB9423A7FC93A039655B59C38F0CCC92FFEFF47D85845DD16FA87E4FFE2CE6E0A30143144E0811A1F7537E82BD3AF2352AD7D2BBEB86D391");Z=ad(V);ao=X[0];an=X[1];am=X[2];ak=X[3];for(af=0;af<Z.length;af+=16){ag=ao;S=an;Y=am;ae=ak;ao=ac(ao,an,am,ak,Z[af+0],7,X[4]);ak=ac(ak,ao,an,am,Z[af+1],12,X[5]);am=ac(am,ak,ao,an,Z[af+2],17,X[6]);an=ac(an,am,ak,ao,Z[af+3],22,X[7]);ao=ac(ao,an,am,ak,Z[af+4],7,X[8]);ak=ac(ak,ao,an,am,Z[af+5],12,X[9]);am=ac(am,ak,ao,an,Z[af+6],17,X[10]);an=ac(an,am,ak,ao,Z[af+7],22,X[11]);ao=ac(ao,an,am,ak,Z[af+8],7,X[12]);ak=ac(ak,ao,an,am,Z[af+9],12,X[13]);am=ac(am,ak,ao,an,Z[af+10],17,X[14]);an=ac(an,am,ak,ao,Z[af+11],22,X[15]);ao=ac(ao,an,am,ak,Z[af+12],7,X[16]);ak=ac(ak,ao,an,am,Z[af+13],12,X[17]);am=ac(am,ak,ao,an,Z[af+14],17,X[18]);an=ac(an,am,ak,ao,Z[af+15],22,X[19]);ao=al(ao,an,am,ak,Z[af+1],5,X[20]);ak=al(ak,ao,an,am,Z[af+6],9,X[21]);am=al(am,ak,ao,an,Z[af+11],14,X[22]);an=al(an,am,ak,ao,Z[af+0],20,X[23]);ao=al(ao,an,am,ak,Z[af+5],5,X[24]);ak=al(ak,ao,an,am,Z[af+10],9,X[25]);am=al(am,ak,ao,an,Z[af+15],14,X[26]);an=al(an,am,ak,ao,Z[af+4],20,X[27]);ao=al(ao,an,am,ak,Z[af+9],5,X[28]);ak=al(ak,ao,an,am,Z[af+14],9,X[29]);am=al(am,ak,ao,an,Z[af+3],14,X[30]);an=al(an,am,ak,ao,Z[af+8],20,X[31]);ao=al(ao,an,am,ak,Z[af+13],5,X[32]);ak=al(ak,ao,an,am,Z[af+2],9,X[33]);am=al(am,ak,ao,an,Z[af+7],14,X[34]);an=al(an,am,ak,ao,Z[af+12],20,X[35]);ao=T(ao,an,am,ak,Z[af+5],4,X[36]);ak=T(ak,ao,an,am,Z[af+8],11,X[37]);am=T(am,ak,ao,an,Z[af+11],16,X[38]);an=T(an,am,ak,ao,Z[af+14],23,X[39]);ao=T(ao,an,am,ak,Z[af+1],4,X[40]);ak=T(ak,ao,an,am,Z[af+4],11,X[41]);am=T(am,ak,ao,an,Z[af+7],16,X[42]);an=T(an,am,ak,ao,Z[af+10],23,X[43]);ao=T(ao,an,am,ak,Z[af+13],4,X[44]);ak=T(ak,ao,an,am,Z[af+0],11,X[45]);am=T(am,ak,ao,an,Z[af+3],16,X[46]);an=T(an,am,ak,ao,Z[af+6],23,X[47]);ao=T(ao,an,am,ak,Z[af+9],4,X[48]);ak=T(ak,ao,an,am,Z[af+12],11,X[49]);am=T(am,ak,ao,an,Z[af+15],16,X[50]);an=T(an,am,ak,ao,Z[af+2],23,X[51]);ao=ab(ao,an,am,ak,Z[af+0],6,X[52]);ak=ab(ak,ao,an,am,Z[af+7],10,X[53]);am=ab(am,ak,ao,an,Z[af+14],15,X[54]);an=ab(an,am,ak,ao,Z[af+5],21,X[55]);ao=ab(ao,an,am,ak,Z[af+12],6,X[56]);ak=ab(ak,ao,an,am,Z[af+3],10,X[57]);am=ab(am,ak,ao,an,Z[af+10],15,X[58]);an=ab(an,am,ak,ao,Z[af+1],21,X[59]);ao=ab(ao,an,am,ak,Z[af+8],6,X[60]);ak=ab(ak,ao,an,am,Z[af+15],10,X[61]);am=ab(am,ak,ao,an,Z[af+6],15,X[62]);an=ab(an,am,ak,ao,Z[af+13],21,X[63]);ao=ab(ao,an,am,ak,Z[af+4],6,X[64]);ak=ab(ak,ao,an,am,Z[af+11],10,X[65]);am=ab(am,ak,ao,an,Z[af+2],15,X[66]);an=ab(an,am,ak,ao,Z[af+9],21,X[67]);ao=aa(ao,ag);an=aa(an,S);am=aa(am,Y);ak=aa(ak,ae)}return R(ao).concat(R(an),R(am),R(ak))},F=function(W,V,S){W=o(W);V=o(V);for(var U=V.length;U<32;U++){V[U]=0}if(S==null){S=genIV()}else{S=o(S);for(var U=S.length;U<16;U++){S[U]=0}}var T=b(W,V,S);var R=[S];for(var U=0;U<T.length;U++){R[R.length]=T[U]}return Base64.encode(R)};decString=function(W,V){var U=Base64.decode(W);var R=U.slice(0,16);var T=U.slice(16,U.length);V=o(V);for(var S=V.length;S<32;S++){V[S]=0}var X=y(T,V,R,false);return X};Base64=(function(){var R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",T=R.split(""),S=function(V,Z){var aa=[],Y="",X,W;totalChunks=Math.floor(V.length*16/3);for(X=0;X<V.length*16;X++){aa.push(V[Math.floor(X/16)][X%16])}for(X=0;X<aa.length;X=X+3){Y+=T[aa[X]>>2];Y+=T[((aa[X]&3)<<4)|(aa[X+1]>>4)];if(!(aa[X+1]===undefined)){Y+=T[((aa[X+1]&15)<<2)|(aa[X+2]>>6)]}else{Y+="="}if(!(aa[X+2]===undefined)){Y+=T[aa[X+2]&63]}else{Y+="="}}W=Y.slice(0,64)+"\n";for(X=1;X<(Math.ceil(Y.length/64));X++){W+=Y.slice(X*64,X*64+64)+(Math.ceil(Y.length/64)==X+1?"":"\n")}return W},U=function(W){W=W.replace(/\n/g,"");var Y=[],Z=[],V=[],X;for(X=0;X<W.length;X=X+4){Z[0]=R.indexOf(W.charAt(X));Z[1]=R.indexOf(W.charAt(X+1));Z[2]=R.indexOf(W.charAt(X+2));Z[3]=R.indexOf(W.charAt(X+3));V[0]=(Z[0]<<2)|(Z[1]>>4);V[1]=((Z[1]&15)<<4)|(Z[2]>>2);V[2]=((Z[2]&3)<<6)|Z[3];Y.push(V[0],V[1],V[2])}Y=Y.slice(0,Y.length-(Y.length%16));return Y};if(typeof Array.indexOf==="function"){R=T}return{encode:S,decode:U}})();return{size:c,h2a:E,expandKey:J,encryptBlock:d,decryptBlock:I,Decrypt:f,s2a:o,rawEncrypt:b,dec:u,openSSLKey:q,a2h:r,enc:s,Hash:{MD5:m},Base64:Base64}})();if(typeof define==="function"){define(function(){return GibberishAES})};
